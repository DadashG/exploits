#!/usr/bin/python3
import sys,requests as r
from threading import Thread
actionlist=[]
wordlist=[]
def getlist(filename,listname):
    with open(filename, 'r') as list:
        for line in list:
            listname.append(line.strip("\n"))

def bust(url,action,words):
    for word in words:
        requrl="{}/{}/{}".format(url,action,word.strip())
        getreq=r.get(requrl).status_code
        postreq=r.post(requrl).status_code
        putreq=r.put(requrl).status_code
        patchreq=r.patch(requrl).status_code
        if((getreq in [204,401,403,404]) 
        and (postreq in [204,401,403,404]) 
        and (putreq in [204,401,403,404]) 
        and (patchreq in [204,401,403,404])):
            pass
        else:
            print("{} \t-\t GET[{}] / POST[{}] / PUT[{}] / PATCH[{}]".format(requrl,getreq,postreq,putreq,patchreq))

if __name__ == '__main__':
    if len(sys.argv) != 5:
       print("(+) usage: {} <URL> <ACTIONLIST> <WORDLIST> <THREADS>\n".format(sys.argv[0]))
       print("(+) URL - Remote webapp url (i.e http://gateway:8000)")
       print("(+) ACTIONLIST - First wordlist for actions")
       print("(+) WORDLIST - Second wordlist for busting")
       print("(+) THREADS - Threads in num (i.e: 100)\n")
       sys.exit(-1)
    url = sys.argv[1]
    actions = sys.argv[2]
    wlist = sys.argv[3]
    threadnum = int(sys.argv[4])

getlist(actions,actionlist)
getlist(wlist,wordlist)
wpth = len(wordlist) // threadnum
for action in actionlist:
    for i in range(threadnum):
        start = i * wpth
        end = (i+1) * wpth
        t=Thread(target=bust, args=[url,action,wordlist[start:end]])
        t.start()
    t.join()
